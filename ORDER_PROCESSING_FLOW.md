# تدفق معالجة الطلبات - دليل الأدمن

## 📋 الخطوات الكاملة لمعالجة الطلب

### 1️⃣ استقبال الطلب
- يصل الطلب للأدمن مع جميع التفاصيل
- يظهر زر **"🔧 معالجة الطلب"** تحت رسالة الطلب
- تظهر رسالة إثبات الدفع مرفقة مع الطلب

### 2️⃣ تأكيد صحة الدفع
عند الضغط على زر "معالجة الطلب":
- يسأل البوت: **"هل عملية الدفع ناجحة وحقيقية؟"**
- خيارين:
  - ✅ **نعم** → الانتقال لجمع تفاصيل البروكسي
  - ❌ **لا** → رفض الطلب

---

## ❌ في حالة رفض الطلب (اختيار "لا")

### خطوات الرفض:
1. **تحديث حالة الطلب** → `failed`
2. **سؤال عن الرسالة المخصصة**:
   - "هل تريد إرسال رسالة مخصصة للمستخدم؟"
   - **نعم** → إدخال رسالة مخصصة
   - **لا** → إرسال رسالة الرفض الافتراضية

3. **إرسال إشعار للمستخدم**:
   - رسالة مخصصة (إذا تم اختيارها)
   - أو رسالة افتراضية: "❌ تم رفض طلبك. يرجى التحقق من إثبات الدفع والمحاولة مرة أخرى."

4. **جدولة الحذف**:
   - ⏰ حذف تلقائي للطلب بعد **48 ساعة**
   - إشعار المستخدم بانتهاء صلاحية الطلب

---

## ✅ في حالة قبول الطلب (اختيار "نعم")

### مراحل جمع تفاصيل البروكسي:

#### 1️⃣ **نوع البروكسي**
- خيارين بوضع Inline:
  - 🔧 ستاتيك
  - 🧦 سوكس

#### 2️⃣ **عنوان البروكسي**
- إدخال يدوي للعنوان/IP

#### 3️⃣ **البورت**  
- إدخال يدوي لرقم البورت

#### 4️⃣ **الدولة**
- قائمة بالدول المتاحة:
  - 🇺🇸 أميركا
  - 🇬🇧 بريطانيا  
  - 🇩🇪 ألمانيا
  - 🇫🇷 فرنسا
- زر **"غير ذلك"** للإدخال اليدوي

#### 5️⃣ **الولاية**
- قائمة بالولايات (حسب الدولة المختارة)
- زر **"غير ذلك"** للإدخال اليدوي

#### 6️⃣ **اسم المستخدم**
- إدخال يدوي لاسم المستخدم

#### 7️⃣ **كلمة المرور**
- إدخال يدوي لكلمة المرور

#### 8️⃣ **رسالة الشكر**
- إدخال رسالة شكر قصيرة للمستخدم

---

## 📤 إرسال البروكسي النهائي

### للمستخدم:
```
✅ تم معالجة طلب [اسم المستخدم]

🔐 تفاصيل البروكسي:
📡 العنوان: `[العنوان]`
🔌 البورت: `[البورت]`
🌍 الدولة: [الدولة]
🏠 الولاية: [الولاية]
👤 اسم المستخدم: `[اسم المستخدم]`
🔑 كلمة المرور: `[كلمة المرور]`

━━━━━━━━━━━━━━━
🆔 معرف الطلب: `[معرف الطلب]`
📅 التاريخ: [التاريخ]
🕐 الوقت: [الوقت]

━━━━━━━━━━━━━━━
💬 [رسالة الشكر]
```

### للأدمن (رسالة تأكيد):
- نفس المحتوى مع إضافة "تم معالجة طلب [الاسم]" في الأعلى
- تأكيد بنجاح العملية

---

## 🔄 تحديث حالة الطلب

### في قاعدة البيانات:
- **الحالة** → `completed`
- **تاريخ المعالجة** → الوقت الحالي
- **تفاصيل البروكسي** → JSON مع جميع البيانات

### تنظيف البيانات:
- حذف البيانات المؤقتة من `context.user_data`
- إنهاء المحادثة

---

## 📊 الميزات الإضافية

### ⏰ إدارة الوقت:
- تسجيل دقيق للتاريخ والوقت
- حذف تلقائي للطلبات الفاشلة بعد 48 ساعة

### 🔒 الأمان:
- تشفير تفاصيل البروكسي في قاعدة البيانات
- تنظيف البيانات المؤقتة بعد الانتهاء

### 💬 التواصل:
- إشعارات فورية للمستخدم
- رسائل مخصصة عند الرفض
- رسائل شكر قابلة للتخصيص

---

## 🚨 ملاحظات مهمة

1. **لا تتوقف عن العمل** ✅ - البوت يحافظ على وظائفه الأساسية
2. **معالجة الأخطاء** ✅ - التعامل مع الحالات الاستثنائية
3. **سهولة الاستخدام** ✅ - واجهة بديهية خطوة بخطوة
4. **المرونة** ✅ - إمكانية الإدخال اليدوي في جميع المراحل

**البوت الآن جاهز للاستخدام المباشر! 🚀**