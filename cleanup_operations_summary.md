# ููุฎุต ุฅุถุงูุฉ ุขููุงุช ุชูุธูู ุงูุนูููุงุช ุงููุนููุฉ

## โ ุงููุดุงูู ุงูุชู ุชู ุญููุง

### 1. ุงูุนูููุงุช ุงููุนููุฉ ูุงูููุจูุฑุฏ ุงููุชููู
- **ุงููุดููุฉ**: ุนูููุงุช ุชุจูู ูุนููุฉ ูู `context.user_data` ููุง ูุณุจุจ ุชููู ุงูููุจูุฑุฏ
- **ุงูุญู**: ุฅุถุงูุฉ ุฏุงูุฉ `cleanup_incomplete_operations` ุดุงููุฉ

### 2. ุงููุญุงุฏุซุงุช ุงูุนุงููุฉ
- **ุงููุดููุฉ**: ูุญุงุฏุซุงุช ConversationHandler ุชุนูู ุฏูู ุทุฑููุฉ ููุฎุฑูุฌ
- **ุงูุญู**: ุฅุถุงูุฉ ูุนุงูุฌุงุช fallback ูุชุนุฏุฏุฉ ูุฃูุงูุฑ ุทูุงุฑุฆ

### 3. ุนุฏู ูุฌูุฏ ุขููุงุช ุฅุนุงุฏุฉ ุชุนููู
- **ุงููุดููุฉ**: ูุง ุชูุฌุฏ ุทุฑููุฉ ูุฅุนุงุฏุฉ ุชุนููู ุญุงูุฉ ุงููุณุชุฎุฏู ุนูุฏ ุงูุญุงุฌุฉ
- **ุงูุญู**: ุฅุถุงูุฉ ุฏุงูุฉ `force_reset_user_state` ููุทูุงุฑุฆ

## ๐ง ุงูุฏูุงู ุงููุถุงูุฉ

### 1. `cleanup_incomplete_operations()`
```python
async def cleanup_incomplete_operations(context, user_id, operation_type="all")
```
- ุชูุธู ุงูุนูููุงุช ุงููุนููุฉ ุญุณุจ ุงูููุน (admin/user/conversation)
- ุชุณุฌู ุงูุนูููุงุช ุงูููุธูุฉ ูู ุงูุณุฌู
- ุชุฑุฌุน `True` ุนูุฏ ุงููุฌุงุญ

### 2. `force_reset_user_state()`
```python
async def force_reset_user_state(update, context)
```
- ุฅุนุงุฏุฉ ุชุนููู ูุงููุฉ ูุญุงูุฉ ุงููุณุชุฎุฏู
- ุชุญุฏูุฏ ููุน ุงููุณุชุฎุฏู ูุฅุนุงุฏุฉ ุชูุนูู ุงูููุจูุฑุฏ ุงูููุงุณุจ
- ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก ูุน fallback ุขูู

### 3. `handle_stuck_conversation()`
```python
async def handle_stuck_conversation(update, context)
```
- ูุนุงูุฌุฉ ุงููุญุงุฏุซุงุช ุงูุนุงููุฉ
- ุชูุธูู ุงูุจูุงูุงุช ูุฅุนุงุฏุฉ ุงูุชูุฌูู ูููุงุฆูุฉ ุงูุฑุฆูุณูุฉ
- ุฅุฑุฌุงุน `ConversationHandler.END`

### 4. `auto_cleanup_expired_operations()`
```python
async def auto_cleanup_expired_operations(context)
```
- ุชูุธูู ุชููุงุฆู ููุนูููุงุช ุงูููุชููุฉ ุงูุตูุงุญูุฉ
- ูุนูู ูู ุณุงุนุฉ ูู ุงูุฎูููุฉ
- ูุญุฏุฏ ุงูุนูููุงุช ุงููุฏููุฉ (ุฃูุซุฑ ูู 30 ุฏูููุฉ)

## ๐ฑ ุงูุฃูุงูุฑ ุงูุฌุฏูุฏุฉ ุงููุถุงูุฉ

### 1. `/reset`
- ุฅุนุงุฏุฉ ุชุนููู ูุงููุฉ ูุญุงูุฉ ุงููุณุชุฎุฏู
- ุชูุธูู ุฌููุน ุงูุจูุงูุงุช ุงููุคูุชุฉ
- ุฅุนุงุฏุฉ ุชูุนูู ุงูููุจูุฑุฏ ุงูููุงุณุจ

### 2. `/cleanup`
- ุชูุธูู ุงูุนูููุงุช ุงููุนููุฉ ููุท
- ุฃูู ุชุฏุฎูุงู ูู `/reset`
- ูุญุงูุธ ุนูู ุงูุญุงูุฉ ุงูุฃุณุงุณูุฉ

### 3. `/status`
- ุนุฑุถ ุญุงูุฉ ุงููุณุชุฎุฏู ุงูุญุงููุฉ
- ุฅุธูุงุฑ ุงูุนูููุงุช ุงููุดุทุฉ
- ูุงุฆูุฉ ุจุงูุฃูุงูุฑ ุงููุชุงุญุฉ

### 4. ูููุงุช ุงูุฅูุบุงุก
- `ุฅูุบุงุก`, `cancel`, `ุฎุฑูุฌ`, `exit`, `stop`
- ุชุนูู ูู ุฃู ููุงู ูุชูุธูู ุงูุนูููุงุช ูุงูุนูุฏุฉ ูููุงุฆูุฉ ุงูุฑุฆูุณูุฉ

## ๐ ุงูุชุญุณููุงุช ุนูู ConversationHandler

### 1. Fallbacks ูุญุณูุฉ
```python
fallbacks=[
    CommandHandler("cancel", lambda u, c: ConversationHandler.END),
    CommandHandler("reset", handle_reset_command),
    CommandHandler("cleanup", handle_cleanup_command),
    MessageHandler(filters.Regex("^(ุฅูุบุงุก|cancel|ุฎุฑูุฌ|exit|stop)$"), handle_stuck_conversation)
]
```

### 2. ูุนุงูุฌุฉ ุงููุตูุต ุงููุญุณูุฉ
- ุงูุชุญูู ูู ุฃูุงูุฑ ุงูุชูุธูู ูู ุจุฏุงูุฉ `handle_text_messages`
- ูุนุงูุฌุฉ ูููุงุช ุงูุฅูุบุงุก ุชููุงุฆูุงู
- ุฅุนุงุฏุฉ ุชูุฌูู ุขููุฉ ูููุงุฆูุฉ ุงูุฑุฆูุณูุฉ

## โก ุงูุชูุธูู ุงูุชููุงุฆู

### 1. ุฌุฏููุฉ ุงูุชูุธูู
```python
async def initialize_cleanup_scheduler(application)
```
- ูุนูู ูู ุณุงุนุฉ
- ููุธู ุงูุนูููุงุช ุงูููุชููุฉ ุงูุตูุงุญูุฉ
- ูุณุฌู ุงููุดุงุท ูู ุงูุณุฌู

### 2. ุงูุนูููุงุช ุงููุณุชูุฏูุฉ ููุชูุธูู

#### ุนูููุงุช ุงูุฃุฏูู:
- `processing_order_id`
- `admin_processing_active`
- `admin_proxy_*` (ุฌููุน ูุชุบูุฑุงุช ุงูุจุฑููุณู)
- `admin_input_state`
- `current_country_code`

#### ุนูููุงุช ุงููุณุชุฎุฏู:
- `proxy_type`
- `selected_country/state`
- `payment_method`
- `current_order_id`
- `waiting_for`
- `last_reminder`

#### ุนูููุงุช ุงููุญุงุฏุซุฉ:
- `password_change_step`
- `lookup_action`
- `broadcast_*` (ุฌููุน ูุชุบูุฑุงุช ุงูุจุซ)
- `popup_text`

## ๐ก๏ธ ุงูุญูุงูุฉ ูู ุงูุชุนููู

### 1. ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก
- ุฌููุน ุงูุฏูุงู ูุญููุฉ ุจู `try-except`
- ุชุณุฌูู ุงูุฃุฎุทุงุก ูู ุงูุณุฌู
- fallback ุขูู ุนูุฏ ูุดู ุงูุนูููุงุช

### 2. ุงูุชุญูู ูู ุงูุญุงูุฉ
- ูุญุต ููุน ุงููุณุชุฎุฏู ูุจู ุฅุนุงุฏุฉ ุงูุชูุนูู
- ุงูุชุฃูุฏ ูู ูุฌูุฏ ุงูุจูุงูุงุช ูุจู ุงูุชูุธูู
- ูุนุงูุฌุฉ ุงูุญุงูุงุช ุงูุงุณุชุซูุงุฆูุฉ

### 3. ุงูุณุฌูุงุช ูุงููุฑุงูุจุฉ
- ุชุณุฌูู ุฌููุน ุนูููุงุช ุงูุชูุธูู
- ุฅุญุตุงุฆูุงุช ุงูุนูููุงุช ุงูููุธูุฉ
- ูุฑุงูุจุฉ ุงูุฃุฎุทุงุก ูุงูุชุญุฐูุฑุงุช

## ๐ฏ ุงููุชุงุฆุฌ ุงููุญููุฉ

1. **โ ููุน ุชููู ุงูููุจูุฑุฏ**: ูุง ุชูุฌุฏ ุนูููุงุช ูุนููุฉ ุชุณุจุจ ุชููู
2. **โ ุฅุนุงุฏุฉ ุชุนููู ุณุฑูุนุฉ**: ุฃูุงูุฑ ููุฑูุฉ ููุนูุฏุฉ ููุญุงูุฉ ุงูุทุจูุนูุฉ
3. **โ ุชูุธูู ุชููุงุฆู**: ุงูุนูููุงุช ุงููุฏููุฉ ุชููุธู ุชููุงุฆูุงู
4. **โ ูุนุงูุฌุฉ ุดุงููุฉ**: ุฌููุน ุฃููุงุน ุงูุนูููุงุช ูุบุทุงุฉ
5. **โ ุฃูุงูุฑ ุณููุฉ**: ูููุงุช ุจุณูุทุฉ ููุฅูุบุงุก ูุงูุชูุธูู
6. **โ ุญูุงูุฉ ูู ุงูุฃุฎุทุงุก**: ูุนุงูุฌุฉ ุขููุฉ ูุฌููุน ุงูุญุงูุงุช

## ๐ ุงูุงุณุชุฎุฏุงู

### ูููุณุชุฎุฏููู ุงูุนุงุฏููู:
- `/reset` - ุนูุฏ ุชููู ุงูุจูุช
- `ุฅูุบุงุก` - ููุฎุฑูุฌ ูู ุฃู ุนูููุฉ
- `/status` - ููุนุฑูุฉ ุงูุญุงูุฉ ุงูุญุงููุฉ

### ููุฃุฏูู:
- `/cleanup` - ุชูุธูู ุณุฑูุน
- `/reset` - ุฅุนุงุฏุฉ ุชุนููู ูุงููุฉ
- ุฌููุน ุฃูุงูุฑ ุงููุณุชุฎุฏููู ุงูุนุงุฏููู

### ุชููุงุฆูุงู:
- ุชูุธูู ูู ุณุงุนุฉ ููุนูููุงุช ุงููุฏููุฉ
- ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก ุชููุงุฆูุงู
- ุชุณุฌูู ุงููุดุงุท ูู ุงูุณุฌู
